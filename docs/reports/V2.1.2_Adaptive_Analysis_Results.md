# V2.1.2 Adaptive Strategy: Analysis Results

**Date:** 2025-12-08  
**Sample Size:** 50 test examples

---

## Key Finding: Hypothesis Confirmed, But Implementation Fails

### The Hypothesis ✅ CONFIRMED

| Price Tier | Better Endpoint | Win Rate |
|------------|-----------------|----------|
| < $400K (LOW) | `/predict-minimal` | **62%** |
| ≥ $400K (HIGH) | `/predict-full` | **88%** |

**Conclusion:** The price-tier bias is REAL and statistically significant.

---

### The Implementation ❌ FAILED

| Strategy | Avg Error | vs Best |
|----------|-----------|---------|
| `/predict-minimal` (always) | $181,408 | +10.3% |
| `/predict-full` (always) | **$164,495** | baseline |
| `/predict-adaptive` (tier routing) | $166,126 | +1.0% |

**Adaptive routing is WORSE than always using `/predict-full`!**

---

## Why Adaptive Failed

### The Circular Dependency Problem

```
1. To route correctly, we need to know the price tier
2. To know the price tier, we need to predict the price
3. But the prediction has error, especially for high-value homes
4. So we misclassify ~48% of homes to the wrong tier
5. Misclassification errors exceed tier-specific gains
```

### Specific Failure Mode

High-value homes without zipcode demographics get **underestimated**:

| Actual Price | /predict-full Estimate | Classified As | Routed To | Correct? |
|--------------|------------------------|---------------|-----------|----------|
| $550,000 | $380,000 | LOW | minimal | ❌ WRONG |
| $620,000 | $350,000 | LOW | minimal | ❌ WRONG |
| $480,000 | $420,000 | HIGH | full | ✅ Correct |

The **underestimation bias** systematically misroutes high-value homes.

---

## Lessons Learned

### 1. Ground Truth vs Predicted
You can't use a prediction to decide how to predict. This is a form of **information leakage** that introduces noise rather than signal.

### 2. Ensemble > Routing
When you have two models with different strengths, **averaging** often beats **routing**:
- Routing: pick one, risk being totally wrong
- Averaging: get benefits of both, smooth out errors

### 3. Feature-Based Routing Could Work
Instead of predicted price, use **input features** to estimate tier:
- `sqft_living > 2000`
- `grade >= 8`
- `waterfront == 1`
- `view >= 2`

These features are known before prediction and correlate with price tier.

---

## Alternative Approaches to Test

### Option A: Weighted Ensemble

```python
# Average both predictions with weights
weight_minimal = 0.3
weight_full = 0.7  # Full is better overall
prediction = weight_minimal * pred_minimal + weight_full * pred_full
```

### Option B: Feature-Based Routing

```python
# Use known features to estimate tier
def estimate_tier_from_features(features):
    luxury_indicators = (
        features['sqft_living'] > 2500 or
        features['grade'] >= 9 or
        features['waterfront'] == 1 or
        features['view'] >= 3
    )
    return "HIGH" if luxury_indicators else "LOW"
```

### Option C: Adaptive Threshold Search

```python
# Find optimal threshold via cross-validation
for threshold in [300_000, 350_000, 400_000, 450_000, 500_000]:
    # Test adaptive performance at each threshold
    # Pick threshold that minimizes overall error
```

---

## Recommendations

1. **For Production:** Use `/predict-full` always (best overall accuracy)
2. **For Research:** Test ensemble averaging (Option A)
3. **For V2.3:** Focus on hyperparameter tuning instead of routing
4. **Document:** This is a valuable negative result - routing isn't always better

---

## Summary Statistics

```
Sample Size: 50
LOW tier homes: 24 (48%)
HIGH tier homes: 26 (52%)

Tier-specific accuracy:
  LOW:  minimal wins 62%
  HIGH: full wins 88%

Adaptive routing accuracy: 52% (barely better than random)

Best single strategy: /predict-full ($164,495 avg error)
```

---

**Key Insight:**
> "Knowing the optimal strategy per tier is not the same as being able to identify the tier at prediction time."

This is a common pitfall in ML: information available during analysis (actual price tier) is not available during inference.

---

**Document Version:** 1.0  
**Last Updated:** 2025-12-08
