# V3.2 Fresh Data Integration - Summary

**Date:** December 9, 2025  
**Branch:** feature/v3.2-fresh-data  
**Status:** Phase 1 Complete - Data Exploration & Zero-Shot Evaluation

---

## Executive Summary

We successfully integrated King County 2020+ assessment data and evaluated how the V2.5 model (trained on 2014-2015 data) performs on current market data. **The key finding: The model requires retraining** due to significant market price changes.

### Key Metrics

| Metric | Original (2015 Data) | Fresh Data (2020+) | Change |
|--------|---------------------|-------------------|--------|
| MAE | $63,529 | $679,030 | +969% |
| MAPE | 12% | 60.4% | +48pp |
| R² | 0.8945 | -0.32 | -1.21 |
| Median Price | ~$450K | $845K | +88% |

---

## What We Did

### 1. Data Pipeline Created
- **Source:** King County Assessor's Office public data
- **Files Used:**
  - `EXTR_RPSale.csv` (609 MB) - Real property sales
  - `EXTR_ResBldg.csv` (147 MB) - Residential buildings  
  - `EXTR_Parcel.csv` (236 MB) - Parcel information
- **Script:** `src/data/transform_assessment_data.py`

### 2. Schema Mapping
Successfully mapped 15 of 17 original features:

| Original Feature | Assessment Source | Status |
|-----------------|-------------------|--------|
| price | EXTR_RPSale.SalePrice | ✅ |
| bedrooms | EXTR_ResBldg.Bedrooms | ✅ |
| bathrooms | Calculated from BathFullCount + Bath3qtrCount + BathHalfCount | ✅ |
| sqft_living | EXTR_ResBldg.SqFtTotLiving | ✅ |
| sqft_lot | EXTR_Parcel.SqFtLot | ✅ |
| floors | EXTR_ResBldg.Stories | ✅ |
| waterfront | Derived from WfntLocation | ✅ |
| view | EXTR_ResBldg.ViewUtilization | ✅ |
| condition | EXTR_ResBldg.Condition | ✅ |
| grade | EXTR_ResBldg.BldgGrade | ✅ |
| sqft_above | Calculated from floor sqft columns | ✅ |
| sqft_basement | EXTR_ResBldg.SqFtTotBasement | ✅ |
| yr_built | EXTR_ResBldg.YrBuilt | ✅ |
| yr_renovated | EXTR_ResBldg.YrRenovated | ✅ |
| zipcode | EXTR_ResBldg.ZipCode | ✅ |
| lat | Not available (geocoding needed) | ⚠️ Default used |
| long | Not available (geocoding needed) | ⚠️ Default used |

### 3. Data Transformation Results
- **Input:** 216,298 sales from 2020+
- **After joins:** 155,983 records (72% match rate)
- **Sample evaluated:** 49,964 records
- **Data quality:** 99.9% valid after cleaning

### 4. Zero-Shot Evaluation
Script: `scripts/evaluate_zero_shot.py`

Key findings:
1. **Systematic Underprediction:** Model underpredicts by $669K on average
2. **Market Change:** 88% price inflation from 2015 to 2020+
3. **Pattern Recognition:** Even with wrong scale, R² was negative but model captured relative patterns
4. **Verdict:** Retraining required for production use

---

## Performance by Price Tier

| Price Tier | MAE | MAPE | Samples |
|------------|-----|------|---------|
| < $400K | $145K | 74% | 2,585 |
| $400K - $600K | $263K | 51% | 8,382 |
| $600K - $800K | $399K | 57% | 11,722 |
| $800K - $1M | $529K | 60% | 8,443 |
| $1M - $1.5M | $766K | 63% | 9,885 |
| > $1.5M | $1.63M | 67% | 8,947 |

The worst performance is in the luxury segment (>$1.5M) which has the most market volatility.

---

## Files Created

```
src/data/
  __init__.py
  transform_assessment_data.py    # Data transformation pipeline

scripts/
  explore_assessment_data.py      # Data exploration
  evaluate_zero_shot.py           # Zero-shot evaluation

data/
  assessment_2020_plus.csv        # Transformed 2020+ sales data (sample)
  zero_shot_evaluation.json       # Evaluation results
```

---

## Next Steps

### Immediate (V3.2 Completion)
1. **Retrain model on 2020+ data** using existing MLflow infrastructure
2. Compare new model to V2.5 baseline
3. Deploy updated model to API

### Future Considerations
1. **Geocoding:** Add lat/long via address geocoding for better location features
2. **Neighbor features:** Calculate sqft_living15/sqft_lot15 from nearby parcels
3. **Demographics update:** Find 2024 census data for zipcode features
4. **Continuous training:** Set up pipeline to retrain on new assessment data releases

---

## Commands Reference

```bash
# Transform assessment data
python src/data/transform_assessment_data.py --sample 50000

# Run zero-shot evaluation
python scripts/evaluate_zero_shot.py

# Train model with MLflow
python src/train_with_mlflow.py

# View MLflow UI
mlflow ui --backend-store-uri sqlite:///mlflow/mlflow.db
```

---

**Document Created:** 2025-12-09  
**Author:** AI Assistant (V3.2 Fresh Data Integration)
